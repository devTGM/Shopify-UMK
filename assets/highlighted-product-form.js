(()=>{if(!customElements.get("product-form")){class t extends HTMLElement{constructor(){super(),this.form=this.querySelector("form"),this.submitButton=this.form.querySelector('[name="add"]'),this.cartDrawer=document.querySelector("cart-drawer"),this.productBar=document.querySelector(`#ProductBar-${this.dataset.sectionId}`),this.form.addEventListener("submit",this.onSubmitHandler.bind(this))}onSubmitHandler(t){t.preventDefault();const e=document.querySelector("purchase-options");if(e&&!e.isOneTimePurchase()&&!this.hasAttribute("data-has-selling-plan"))return void e.showError();this.submitButton.classList.add("disabled");const r=fetchConfig("javascript");r.headers["X-Requested-With"]="XMLHttpRequest",delete r.headers["Content-Type"];const s=new FormData(this.form);s.append("sections",this.cartDrawer.getSectionsToRender().map((t=>t.section))),s.append("sections_url",window.location.pathname),r.body=s,fetch(`${routes.cart_add_url}`,r).then((t=>t.json())).then((t=>{if(t.status)return void this.handleErrorMessage(t.message);this.cartDrawer.renderContents(t);const e=document.querySelector(".cart-drawer__title-counter");if(e){var r=e.innerHTML;r=parseInt(r)+1,e.innerHTML=r}})).catch((t=>{console.error(t)})).finally((()=>{this.submitButton.classList.remove("disabled")}))}handleErrorMessage(t=!1){const e=this.querySelector("[data-error-wrapper]");e&&(e.classList.toggle("hidden",!t),e.textContent=t||"",setTimeout((()=>{e.classList.add("hidden")}),5e3))}toggleAddButton(t,e){[this.submitButton,this.productBar?.querySelector('[name="add"]')].forEach((r=>{t?(r?.setAttribute("disabled","disabled"),e&&r&&(r.textContent=e)):r&&(r.removeAttribute("disabled"),r.textContent=this.hasAttribute("data-has-selling-plan")?window.variantStrings.addSubscriptionToCart:window.variantStrings.addToCart)}))}}customElements.define("product-form",t)}})()