class HTMLUpdateUtility{static viewTransition(t,e,i=[],a=[]){i?.forEach((t=>t(e)));const s=document.createElement("div");HTMLUpdateUtility.setInnerHTML(s,e.outerHTML);const r=s.firstChild,n=Date.now();t.querySelectorAll("[id], [form]").forEach((t=>{t.id&&(t.id=`${t.id}-${n}`),t.form&&t.setAttribute("form",`${t.form.getAttribute("id")}-${n}`)})),t.parentNode.insertBefore(r,t),t.style.display="none",a?.forEach((t=>t(r))),setTimeout((()=>t.remove()),500)}static setInnerHTML(t,e){t.innerHTML=e,t.querySelectorAll("script").forEach((t=>{const e=document.createElement("script");Array.from(t.attributes).forEach((t=>{e.setAttribute(t.name,t.value)})),e.appendChild(document.createTextNode(t.innerHTML)),t.parentNode.replaceChild(e,t)}))}}class QuantityInputDawn extends HTMLElement{constructor(){super(),this.input=this.querySelector("input"),this.changeEvent=new Event("change",{bubbles:!0}),this.input.addEventListener("change",this.onInputChange.bind(this)),this.querySelectorAll("button").forEach((t=>t.addEventListener("click",this.onButtonClick.bind(this))))}quantityUpdateUnsubscriber=void 0;connectedCallback(){this.validateQtyRules(),this.quantityUpdateUnsubscriber=subscribe(PUB_SUB_EVENTS.quantityUpdate,this.validateQtyRules.bind(this))}disconnectedCallback(){this.quantityUpdateUnsubscriber&&this.quantityUpdateUnsubscriber()}onInputChange(t){this.validateQtyRules()}onButtonClick(t){t.preventDefault();const e=this.input.value;"plus"===t.target.name?parseInt(this.input.dataset.min)>parseInt(this.input.step)&&0==this.input.value?this.input.value=this.input.dataset.min:this.input.stepUp():this.input.stepDown(),e!==this.input.value&&this.input.dispatchEvent(this.changeEvent),this.input.dataset.min===e&&"minus"===t.target.name&&(this.input.value=parseInt(this.input.min))}validateQtyRules(){const t=parseInt(this.input.value);if(this.input.min){this.querySelector(".quantity__button[name='minus']").classList.toggle("disabled",parseInt(t)<=parseInt(this.input.min))}if(this.input.max){const e=parseInt(this.input.max);this.querySelector(".quantity__button[name='plus']").classList.toggle("disabled",t>=e)}}}customElements.define("quantity-input-dawn",QuantityInputDawn);class ProductVariantSelects extends HTMLElement{constructor(){super()}connectedCallback(){this.addEventListener("change",(t=>{const e=this.getInputForEventTarget(t.target);this.updateSelectionMetadata(t),publish(PUB_SUB_EVENTS.optionValueSelectionChange,{data:{event:t,target:e,selectedOptionValues:this.selectedOptionValues}})}))}updateSelectionMetadata({target:t}){const{value:e,tagName:i}=t;if("SELECT"===i&&t.selectedOptions.length){Array.from(t.options).find((t=>t.getAttribute("selected"))).removeAttribute("selected");const i=Array.from(t.options).find((t=>t.value===e));i&&i.setAttribute("selected","selected");const a=t.selectedOptions[0].dataset.optionSwatchValue,s=t.closest(".product-form__input").querySelector("[data-selected-value] > .product-option__swatch");if(!s)return;a?(s.style.setProperty("--swatch--background",a),s.classList.remove("product-option__swatch--unavailable")):(s.style.setProperty("--swatch--background","unset"),s.classList.add("product-option__swatch--unavailable")),s.style.setProperty("--swatch-focal-point",t.selectedOptions[0].dataset.optionSwatchFocalPoint||"unset")}else if("INPUT"===i&&"radio"===t.type){const i=t.closest(".product-form__input").querySelector("[data-selected-value]");i&&(i.innerHTML=e)}}getInputForEventTarget(t){return"SELECT"===t.tagName?t.selectedOptions[0]:t}get selectedOptionValues(){return Array.from(this.querySelectorAll("select option[selected], fieldset input:checked")).map((({dataset:t})=>t.optionValueId))}}customElements.define("product-variant-selects",ProductVariantSelects),customElements.get("product-info")||customElements.define("product-info",class extends HTMLElement{quantityInput=void 0;quantityForm=void 0;onVariantChangeUnsubscriber=void 0;cartUpdateUnsubscriber=void 0;abortController=void 0;pendingRequestUrl=null;preProcessHtmlCallbacks=[];postProcessHtmlCallbacks=[];constructor(){super(),this.quantityInput=this.querySelector(".quantity__input"),this.productMediaGallery=this.querySelector(`[id^="MediaGallery-${this.dataset.section}"]`),this.productVariantSelects=this.querySelector("product-variant-selects")}connectedCallback(){this.initializeProductSwapUtility(),this.onVariantChangeUnsubscriber=subscribe(PUB_SUB_EVENTS.optionValueSelectionChange,this.handleOptionValueChange.bind(this)),this.initQuantityHandlers(),this.dispatchEvent(new CustomEvent("product-info:loaded",{bubbles:!0})),this.initUpdateMedia(),this.productMediaGallery&&"true"===this.productMediaGallery.dataset.hideOtherVariantsMedia&&this.updateVariantMedia()}addPreProcessCallback(t){this.preProcessHtmlCallbacks.push(t)}initQuantityHandlers(){this.quantityInput&&(this.quantityForm=this.querySelector(".product-form__quantity"),this.quantityForm&&(this.setQuantityBoundries(),this.dataset.originalSection||(this.cartUpdateUnsubscriber=subscribe(PUB_SUB_EVENTS.cartUpdate,this.fetchQuantityRules.bind(this)))))}initUpdateMedia(){const t=parseInt(window.location.search.split("?").filter((t=>t.includes("variant=")))[0]?.split("=")[1])||null;if(!t)return;const e=this.getSelectedVariant(this);e&&t&&e?.id===t&&this.updateMedia(e?.featured_media?.id)}disconnectedCallback(){this.onVariantChangeUnsubscriber(),this.cartUpdateUnsubscriber?.()}initializeProductSwapUtility(){this.preProcessHtmlCallbacks.push((t=>t.querySelectorAll(".scroll-trigger").forEach((t=>t.classList.add("scroll-trigger--cancel"))))),this.postProcessHtmlCallbacks.push((t=>{window?.Shopify?.PaymentButton?.init(),window?.ProductModel?.loadShopifyXR()}))}handleOptionValueChange({data:{event:t,target:e,selectedOptionValues:i}}){if(!this.contains(t.target))return;this.resetProductFormState();const a=e.dataset.productUrl||this.pendingRequestUrl||this.dataset.url;this.pendingRequestUrl=a;const s=this.dataset.url!==a,r="true"===this.dataset.updateUrl&&s;this.renderProductInfo({requestUrl:this.buildRequestUrlWithParams(a,i,r),targetId:e.id,callback:s?this.handleSwapProduct(a,r):this.handleUpdateProductInfo(a)})}resetProductFormState(){const t=this.productForm;t?.toggleSubmitButton(!0),t?.handleErrorMessage()}handleSwapProduct(t,e){return i=>{this.productModal?.remove();const a=e?"product-info[id^='MainProduct']":"product-info",s=this.getSelectedVariant(i.querySelector(a));this.updateURL(t,s?.id),e?(document.querySelector("head title").innerHTML=i.querySelector("head title").innerHTML,HTMLUpdateUtility.viewTransition(document.querySelector("main"),i.querySelector("main"),this.preProcessHtmlCallbacks,this.postProcessHtmlCallbacks)):HTMLUpdateUtility.viewTransition(this,i.querySelector("product-info"),this.preProcessHtmlCallbacks,this.postProcessHtmlCallbacks)}}renderProductInfo({requestUrl:t,targetId:e,callback:i}){this.abortController?.abort(),this.abortController=new AbortController,fetch(t,{signal:this.abortController.signal}).then((t=>t.text())).then((t=>{this.pendingRequestUrl=null;const e=(new DOMParser).parseFromString(t,"text/html");i(e)})).then((()=>{document.querySelector(`#${e}`)?.focus()})).catch((t=>{t.name}))}getSelectedVariant(t){const e=t.querySelector("product-variant-selects [data-selected-variant]")?.innerHTML;return e?JSON.parse(e):null}buildRequestUrlWithParams(t,e,i=!1){const a=[];return!i&&a.push(`section_id=${this.sectionId}`),e.length&&a.push(`option_values=${e.join(",")}`),`${t}?${a.join("&")}`}updateOptionValues(t){const e=t.querySelector("product-variant-selects");e&&HTMLUpdateUtility.viewTransition(this.variantSelectors,e,this.preProcessHtmlCallbacks)}handleUpdateProductInfo(t){return e=>{const i=this.getSelectedVariant(e);if(this.updateOptionValues(e),this.updateURL(t,i?.id),this.updateVariantInputs(i?.id),this.updateVariantDiscountBadge(i?.price,i?.compare_at_price),this.updateVariantDetails(i?.id),this.pickupAvailability&&i?.id&&(this.pickupAvailability.dataset.variantId=i.id,this.pickupAvailability.fetchAvailability(i.id)),this.productMediaGallery&&"true"===this.productMediaGallery.dataset.hideOtherVariantsMedia&&this.updateVariantMedia(e),!i)return void this.setUnavailable();this.updateMedia(i?.featured_media?.id);const a=(t,i=(t=>!1))=>{const a=e.getElementById(`${t}-${this.sectionId}`),s=this.querySelector(`#${t}-${this.dataset.section}`);if(a&&s)if(s.innerHTML=a.innerHTML,"Inventory"===t){const t=parseInt(a.dataset.inventoryThreshold),e=parseInt(a.dataset.inventoryQuantity);s.classList.toggle("hidden",t&&e>t||e<1)}else s.classList.toggle("hidden",i(a))};a("ProductPurchaseInfo"),a("ProductStickyCart"),a("price"),a("Sku",(({classList:t})=>t.contains("hidden"))),a("Inventory",(({innerText:t})=>""===t)),this.updateQuantityRules(this.sectionId,e),this.querySelector(`#Quantity-Rules-${this.dataset.section}`)?.classList.remove("hidden"),this.productForm?.toggleSubmitButton(e.getElementById(`ProductSubmitButton-${this.sectionId}`)?.hasAttribute("disabled")??!0,window.variantStrings.soldOut),publish(PUB_SUB_EVENTS.variantChange,{data:{sectionId:this.sectionId,html:e,variant:i}})}}updateVariantMedia(){const t=this.querySelector("product-variant-selects [data-selected-variant-options-handle]")?.innerHTML.trim();if(!t){const t=this.productVariantSelects.querySelector("[data-all-variants]").innerHTML.trim();this.productVariantSelects.addEventListener("click",(e=>{const i=e.target.closest(".product-option__input");if(i){const e=i.value;JSON.parse(t).find((t=>t.options.some((t=>t===e))))}}))}this.productMediaGallery.querySelectorAll("[data-media-group]").forEach((t=>t.classList.add("hidden"))),this.productMediaGallery.querySelectorAll(`[data-media-group="${t}"]`).forEach((t=>t.classList.remove("hidden"))),this.productMediaGallery.querySelectorAll("swiper-product-gallery").forEach((t=>{t.instance?t.instance.update():t.init()}))}updateVariantOptionMedia(){this.productMediaGallery.querySelectorAll("[data-media-group]:not(.hidden)").forEach((t=>{}))}updateVariantInputs(t){this.querySelectorAll(`#product-form-${this.dataset.section}, #product-form-installment-${this.dataset.section}`).forEach((e=>{const i=e.querySelector('input[name="id"]');i.value=t??"",i.dispatchEvent(new Event("change",{bubbles:!0}))}))}updateURL(t,e){this.querySelector("share-button")?.updateUrl(`${window.shopUrl}${t}${e?`?variant=${e}`:""}`),"false"!==this.dataset.updateUrl&&window.history.replaceState({},"",`${t}${e?`?variant=${e}`:""}`)}updateSellingPlanURL(t,e){if(e)if(t){const i=new URLSearchParams(window.location.search);i[i.has("variant")?"set":"append"]("variant",e),t?i[i.has("selling_plan")?"set":"append"]("selling_plan",t):i.delete("selling_plan"),window.history.replaceState({},"",`${this.dataset.url}?${i.toString()}`)}else window.history.replaceState({},"",`${window.location.href.replace(/&selling_plan=\d+/,"")}`)}updateVariantDetails(t){const e=this.querySelectorAll(".product__metafield_for_variant-block");e&&e.forEach((e=>{const i=e.getAttribute("data-block-id"),a=this.querySelector(`#product__metafield_for_variant-block--${i}`);if(a)try{let i=JSON.parse(a?.textContent);e.innerHTML=i?.[t]?.replaceAll("\n","<br />")||""}catch(t){console.error("Error parsing JSON",t)}}))}updateVariantDiscountBadge(t,e){const i=this.querySelector(".product-card__badge--discount");if(i)if(e>t){i.classList.remove("hidden");const a=i.querySelector(".percentage"),s=Math.round((e-t)/e*100);a.textContent=s}else i.classList.add("hidden")}setUnavailable(){this.productForm?.toggleSubmitButton(!0,window.variantStrings.unavailable);const t=["price","Inventory","Sku","Quantity-Rules"].map((t=>`#${t}-${this.dataset.section}`)).join(", ");document.querySelectorAll(t).forEach((({classList:t})=>t.add("hidden")))}updateMedia(t){if(!t)return;const e=this.querySelector(".main-product__media--grid");if(e){e.querySelectorAll(".swiper-slide").forEach((t=>{t.classList.remove("active")}));const i=e.querySelector(`.swiper-slide[data-media-id="${t}"]`);i&&i.classList.add("active")}this.querySelector(".main-product__media")?.hasAttribute("data-desktop-grid")&&window.innerWidth>=750&&this.scrollToImage(t);const i=this.querySelector("swiper-product-gallery");i?.setActiveMedia(t)}scrollToImage(t){this.querySelectorAll("[data-media-id]").forEach((e=>{e.getAttribute("data-media-id")==t&&e.scrollIntoView({block:"end",behavior:"smooth"})}))}setQuantityBoundries(){const t={cartQuantity:this.quantityInput.dataset.cartQuantity?parseInt(this.quantityInput.dataset.cartQuantity):0,min:this.quantityInput.dataset.min?parseInt(this.quantityInput.dataset.min):1,max:this.quantityInput.dataset.max?parseInt(this.quantityInput.dataset.max):null,step:this.quantityInput.step?parseInt(this.quantityInput.step):1};let e=t.min;const i=null===t.max?t.max:t.max-t.cartQuantity;null!==i&&(e=Math.min(e,i)),t.cartQuantity>=t.min&&(e=Math.min(e,t.step)),this.quantityInput.min=e,i?this.quantityInput.max=i:this.quantityInput.removeAttribute("max"),this.quantityInput.value=e,publish(PUB_SUB_EVENTS.quantityUpdate,void 0)}fetchQuantityRules(){const t=this.productForm?.variantIdInput?.value;t&&(this.querySelector(".quantity__rules-cart .loading__spinner").classList.remove("hidden"),fetch(`${this.dataset.url}?variant=${t}&section_id=${this.dataset.section}`).then((t=>t.text())).then((t=>{const e=(new DOMParser).parseFromString(t,"text/html");this.updateQuantityRules(this.dataset.section,e)})).catch((t=>console.error(t))).finally((()=>this.querySelector(".quantity__rules-cart .loading__spinner").classList.add("hidden"))))}updateQuantityRules(t,e){if(!this.quantityInput)return;this.setQuantityBoundries();const i=e.getElementById(`Quantity-Form-${t}`),a=[".quantity__input",".quantity__rules",".quantity__label"];for(let t of a){const e=this.quantityForm.querySelector(t),a=i.querySelector(t);if(e&&a)if(".quantity__input"===t){const t=["data-cart-quantity","data-min","data-max","step"];for(let i of t){const t=a.getAttribute(i);null!==t?e.setAttribute(i,t):e.removeAttribute(i)}}else e.innerHTML=a.innerHTML}}get productForm(){return this.querySelector("product-form")}get productModal(){return document.querySelector(`#ProductModal-${this.dataset.section}`)}get pickupAvailability(){return this.querySelector("pickup-availability")}get variantSelectors(){return this.querySelector("product-variant-selects")}get relatedProducts(){const t=SectionId.getIdForSection(SectionId.parseId(this.sectionId),"related-products");return document.querySelector(`product-recommendations[data-section-id^="${t}"]`)}get quickOrderList(){const t=SectionId.getIdForSection(SectionId.parseId(this.sectionId),"quick_order_list");return document.querySelector(`quick-order-list[data-id^="${t}"]`)}get sectionId(){return this.dataset.originalSection||this.dataset.section}}),customElements.get("product-form")||customElements.define("product-form",class extends HTMLElement{constructor(){super(),this.form=this.querySelector("form"),this.variantIdInput.disabled=!1,this.form.addEventListener("submit",this.onSubmitHandler.bind(this)),this.cart=document.querySelector("cart-notification")||document.querySelector("cart-drawer"),this.submitButton=this.querySelector('[type="submit"]'),this.submitButtonText=this.submitButton.querySelector("span"),document.querySelector("cart-drawer")&&this.submitButton.setAttribute("aria-haspopup","dialog"),this.hideErrors="true"===this.dataset.hideErrors}onSubmitHandler(t){if(t.preventDefault(),"true"===this.submitButton.getAttribute("aria-disabled"))return;this.handleErrorMessage(),this.submitButton.setAttribute("aria-disabled",!0),this.submitButton.classList.add("loading"),this.querySelector(".loading__spinner").classList.remove("hidden");const e=fetchConfig("javascript");e.headers["X-Requested-With"]="XMLHttpRequest",delete e.headers["Content-Type"];const i=new FormData(this.form);this.cart&&(i.append("sections",this.cart.getSectionsToRender().map((t=>t.section))),i.append("sections_url",window.location.pathname),this.cart.setActiveElement(document.activeElement)),e.body=i,fetch(`${routes.cart_add_url}`,e).then((t=>t.json())).then((t=>{if(t.status){publish(PUB_SUB_EVENTS.cartError,{source:"product-form",productVariantId:i.get("id"),errors:t.errors||t.description,message:t.message}),this.handleErrorMessage(t.description);const e=this.submitButton.querySelector(".sold-out-message");if(!e)return;return this.submitButton.setAttribute("aria-disabled",!0),this.submitButtonText.classList.add("hidden"),e.classList.remove("hidden"),void(this.error=!0)}this.cart?(this.error||publish(PUB_SUB_EVENTS.cartUpdate,{source:"product-form",productVariantId:i.get("id"),cartData:t}),this.error=!1,this.cart.renderContents(t)):window.location=window.routes.cart_url})).catch((t=>{console.error(t)})).finally((()=>{this.submitButton.classList.remove("loading"),this.cart&&this.cart.classList.contains("is-empty")&&this.cart.classList.remove("is-empty"),this.error||this.submitButton.removeAttribute("aria-disabled"),this.querySelector(".loading__spinner").classList.add("hidden")}))}handleErrorMessage(t=!1){this.hideErrors||(this.errorMessageWrapper=this.errorMessageWrapper||this.querySelector(".product-form__error-message-wrapper"),this.errorMessageWrapper&&(this.errorMessage=this.errorMessage||this.errorMessageWrapper.querySelector(".product-form__error-message"),this.errorMessageWrapper.toggleAttribute("hidden",!t),t&&(this.errorMessage.textContent=t)))}toggleSubmitButton(t=!0,e){t?(this.submitButton.setAttribute("disabled","disabled"),e&&(this.submitButtonText.textContent=e)):(this.submitButton.removeAttribute("disabled"),this.submitButtonText.textContent=this.hasAttribute("data-has-selling-plan")?window.variantStrings.addSubscriptionToCart:this.submitButtonText.textContent=this.hasAttribute("data-has-pre-order")?window.variantStrings.preOrder:window.variantStrings.addToCart)}get variantIdInput(){return this.form.querySelector("[name=id]")}}),document.querySelectorAll(".product__content > *").forEach((t=>{t.textContent.trim()||(t.textContent="")}));
