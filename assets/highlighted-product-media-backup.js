if(!customElements.get("product-media")){class e extends HTMLElement{constructor(){super(),this.selectors={slider:"[data-slider]",mediaItem:"[data-media-id]",modalOpeners:"[data-modal-opener-id]",zoomImages:"[data-pswp-image]",btnXr:"[data-shopify-xr]",mediaCounterIndex:"[data-media-counter-index]"},this.selectedMediaIndex=Number(this.querySelector(this.selectors.slider).querySelector("[data-selected]")?.dataset.index)||0;const e=JSON.parse(this.querySelector(this.selectors.slider).getAttribute("data-swiper-options")),t=this.dataset.withThumbs;if(this.settings={sliderElement:()=>{const e=this.querySelector(this.selectors.slider);if(!e)return;const t=e.dataset.slider;return""!==t?document.getElementById(t):e},sliderInstance:null,options:{initialSlide:0,navigation:{prevEl:this.querySelector(".swiper-button--prev"),nextEl:this.querySelector(".swiper-button--next")},pagination:{el:".swiper-pagination",clickable:!0},spaceBetween:8,watchOverflow:!0,watchSlidesVisibility:!0,watchSlidesProgress:!0,preventInteractionOnTransition:!0,autoHeight:this.dataset.autoHeight,on:{afterInit:e=>{this.settings.sliderElement().removeAttribute("style");if(e.slides.length>1){const t=e.slides[0],s=t.querySelector("video");s&&this.playPromise(s);const i=t.querySelector(".js-youtube");i&&this.playYoutubeVideo(i);const o=t.querySelector(".js-vimeo");o&&this.playVimeoVideo(o)}this.addFocusListeners()},slideChangeTransitionEnd:e=>{this.setActiveModalOpener(e)},transitionStart:e=>{const t=e.el.querySelectorAll("video");Array.from(t).forEach((e=>{e.pause()}))},transitionEnd:e=>{if(e.slides.length>1){let t=e.activeIndex;const s=e.slides[0].offsetWidth;t=Math.abs(Math.floor(e.translate/[s]));const i=Array.from(e.slides).find((e=>e.classList.contains("swiper-slide-active"))),o=i.querySelector("video"),n=i.nextElementSibling?.querySelector("video"),r=e=>{e&&e.paused?this.playPromise(e):e&&e.pause()};r(o),r(n);const a=i.querySelector(".js-youtube");a&&this.playYoutubeVideo(a);const l=i.querySelector(".js-vimeo");l&&this.playVimeoVideo(l)}},activeIndexChange:e=>{this.querySelector(this.selectors.mediaCounterIndex)&&(this.querySelector(this.selectors.mediaCounterIndex).textContent=e.activeIndex+1)},touchStart:()=>{this.querySelectorAll(".media video").forEach((e=>{e.removeAttribute("controls")}))},touchEnd:()=>{this.querySelectorAll(".media video").forEach((e=>{e.setAttribute("controls","controls")}))}}}},e&&(this.settings.options.breakpoints={750:{slidesPerView:e.slidesPerViewDesktop}}),"true"===t){const t={swiper:{el:".swiper-thumbs",initialSlide:this.selectedMediaIndex,centeredSlides:!0,centeredSlidesBounds:!0,centerInsufficientSlides:!0,freeMode:{enabled:!0},direction:"horizontal",mousewheel:!0,slidesPerView:6,spaceBetween:2,breakpoints:{750:{direction:e.thumbsDirectionDesktop,spaceBetween:16,slidesPerView:"auto",slidesOffsetAfter:400}},on:{afterInit:e=>{0!==e.activeIndex&&e.slideTo(0);const t=e.wrapperEl,s=new MutationObserver((function(){t.hasAttribute("style")&&t.style?.transform&&"translate3d(0px, 0px, 0px)"!==t.style?.transform?t.style.transform="translate3d(0px, 0px, 0px)":t.hasAttribute("style")&&t.style?.transform&&"translate3d(0px, 0px, 0px)"===t.style?.transform&&setTimeout((()=>{t.hasAttribute("style")&&t.style?.transform&&"translate3d(0px, 0px, 0px)"===t.style?.transform&&s.disconnect()}),500)}));s.observe(t,{attributes:!0})}}}};this.settings.options.thumbs=t,this.settings.options.breakpoints={990:{slidesPerView:e.slidesPerViewDesktop}},this.settings.options.on.init=e=>{setTimeout((()=>{e.thumbs.swiper.el.classList.add("swiper-thumbs--visible")}),10)},this.settings.options.on.slideChangeTransitionStart=e=>{const t=e.thumbs.swiper,s=e.activeIndex;s!==t.activeIndex&&t.slideTo(s)}}else this.settings.options.slidesPerView=1;Shopify.designMode&&window.addEventListener("shopify:section:load",this.init.bind(this))}connectedCallback(){this.init()}init(){"false"===this.dataset.mediaZoom&&this.photoSwipeLightboxInit(),this.swiperInit(),window.onresize=()=>{this.swiperInit()}}swiperInit(){this.settings.sliderInstance=new Swiper(this.settings.sliderElement(),this.settings.options)}addFocusListeners(){this.settings.sliderElement().querySelectorAll(".swiper-slide").forEach(((e,t)=>{e.setAttribute("tabindex","0"),e.addEventListener("focus",(()=>{this.settings.sliderInstance.slideTo(t+1)}))}))}photoSwipeLightboxInit(){const[e,t,s,i,o]=[this.offsetWidth,this.offsetHeight,this.querySelector("[data-close-icon]"),this.querySelector("[data-prev-icon]"),this.querySelector("[data-next-icon]")];function n(){return window.innerWidth<750}const r=new PhotoSwipeLightbox({gallery:"#product-media--photoswipe",children:"a.product__gallery-toggle",mainClass:"pswp--product-media-gallery",loop:!1,showHideAnimationType:"zoom",initialZoomLevel:e=>n()?e.vFill:e.fit,secondaryZoomLevel:e=>n()?e.fit:1,pswpModule:PhotoSwipe});r.addFilter("uiElement",((e,t)=>("close"===t.name?e.innerHTML=s.innerHTML:"arrowPrev"===t.name?e.innerHTML=i.innerHTML:"arrowNext"===t.name&&(e.innerHTML=o.innerHTML),e))),r.addFilter("itemData",((e,t)=>"html"===e.type&&e.element?{html:e.element.dataset.pswpHtml}:e)),r.init(),r.on("beforeOpen",(()=>{document.body.classList.add("oveflow-hidden");const e=this.querySelectorAll("video");Array.from(e).forEach((e=>{e.play().then((()=>{})).catch((t=>{e.pause()}))}))})),r.on("closingAnimationStart",(()=>{document.body.classList.remove("oveflow-hidden")})),this.addEventListener("dragstart",(e=>{e.preventDefault()}))}setActiveMedia(e){const t=Array.from(this.querySelectorAll(this.selectors.mediaItem)).find((t=>Number(t.dataset.mediaId)===e));t&&this.settings.sliderInstance.slideTo(Number(t.dataset.index))}setActiveModalOpener(e){const t=e.slides.filter((e=>e.classList.contains("swiper-slide-active")))[0];if(!t)return;const s=t.dataset.mediaId;this.querySelector(`${this.selectors.modalOpeners}.is-active`)?.classList.remove("is-active"),this.querySelector(`${this.selectors.modalOpeners} [data-media-id="${s}"]`)?.parentElement.classList.add("is-active");if(!("model"===t.dataset.mediaType))return;this.querySelector(this.selectors.btnXr).dataset.shopifyModel3dId=s}playPromise(e){let t=e.play();void 0!==t&&t.then((()=>{})).catch((t=>{e.pause()}))}playYoutubeVideo(e){e.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}',"*")}playVimeoVideo(e){e.contentWindow.postMessage('{"method":"play"}',"*")}}customElements.define("product-media",e)}
