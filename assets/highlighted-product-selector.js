if(!customElements.get("product-selector")){class t extends HTMLElement{constructor(){super(),this.mainElement=this.closest(".highlighted-product"),this.inputWrapper="[data-input-wrapper]",this.variants=JSON.parse(this.querySelector('[type="application/json"]').textContent),this.variantOptionInputs=this.querySelectorAll(".product-option__input"),this.form=document.querySelector(`#ProductForm-${this.dataset.sectionId}`),this.purchaseOptions=document.querySelector(`#Product-Purchase-Options-${this.dataset.sectionId}`),this.productBar=document.querySelector(`#ProductBar-${this.dataset.sectionId}`),this.installmentsForm=document.querySelector(`#Product-Installments-${this.dataset.installmentsFormId}`),this.addEventListener("change",this.onVariantChange),this.addEventListener("keydown",this.onKeyDown),this.updateOptions(),this.updateVariantStatuses(),this.updateVariant(),this.updateMedia(),this.scrollToImage(),this.form?.toggleAddButton(!this.currentVariant.available,"")}updateVariantStatuses(){const t=this.querySelector(this.inputWrapper).querySelector(":checked").value,e=this.variants.filter((e=>t===e.option1)),a=[...this.querySelectorAll(this.inputWrapper)];a.forEach(((t,i)=>{if(0===i)return;const r=a[i-1].querySelector(":checked").value,n=e.filter((t=>t.available&&t[`option${i}`]===r)).map((t=>t[`option${i+1}`]));[...t.querySelectorAll('input[type="radio"], option')].forEach((t=>{const e=!n.includes(t.getAttribute("value"));if(t.disabled=e,"option"===t.tagName.toLowerCase()){const a=`button[data-value="${t.value.replace(/"/g,'\\"')}"]`,i=t.closest("dropdown-input").querySelector(a);i&&(i.disabled=e)}if(!this.productBar)return;const a=t.dataset.id||t.id,i=this.productBar.querySelector(`option[data-id="${a}"]`);i&&(i.disabled=e)}))})),this.querySelectorAll('input[type="radio"]').forEach((t=>{t.checked&&t.nextElementSibling.classList.add("is-active")})),this.updateVariantOptionsLegend()}updatePriceForVariant(t){const e=this.variants.find((e=>e.id===t));if(e){const t=this.mainElement.querySelector(".price__container");if(!t)return;const a=t.dataset.moneyFormat,i=formatPrice(a,e.price/100),r=formatPrice(a,e.compare_at_price/100),n=t.dataset.labelPriceRegular,s=t.dataset.labelPriceSale;if(parseFloat(r)>parseFloat(i)){const e=`\n            <div class="price__sale">\n              <div class="price__sale-inner">\n                <span class="visually-hidden">${s}</span>\n                <s>${r}</s>\n                <ins>\n                  <span class="visually-hidden">${n}</span>\n                  ${i}\n                </ins>\n              </div>\n            </div>\n          `;t.innerHTML=e}else{const e=`\n            <div class="price__sale">\n              <div class="price__sale-inner">\n                <span class="visually-hidden">${n}</span>\n                ${i}\n              </div>\n            </div>\n          `;t.innerHTML=e}}}updateDiscountBadgeForVariant(t){const e=this.variants.find((e=>e.id===t));if(e){const t=this.mainElement.querySelector(".product-card__badge--discount");if(t)if(e.compare_at_price>e.price){t.classList.remove("hidden");const a=t.querySelector(".percentage"),i=Math.round((e.compare_at_price-e.price)/e.compare_at_price*100);a.textContent=i}else t.classList.add("hidden")}}onKeyDown(t){if("Enter"===t.key){const e=t.target;e.classList.contains("swatch")&&e.click()}}onVariantChange(t){if("number"!==t.target.type&&(this.updateOptions(),this.currentVariant!==this.getVariantData())){if(this.updateVariant(),this.updateVariantStatuses(),this.updatePriceForVariant(this.currentVariant.id),this.updateDiscountBadgeForVariant(this.currentVariant.id),this.productBarUpdateOptions(),this.updatePickupAvailability(),this.form.removeAttribute("data-has-selling-plan"),this.form.toggleAddButton(!1,""),this.form.handleErrorMessage(),!this.currentVariant)return this.form.toggleAddButton(!0,""),void this.setUnavailable();this.currentVariant.available||this.form.toggleAddButton(!0,window.variantStrings.soldOut),this.closest(".product").classList.contains("highlighted-product")||this.updateURL(),this.updateVariantInput(),this.renderProductInfo(),this.updateSKU(),this.updateVariantOptionsLegend(),this.updateMedia(),this.scrollToImage()}}updateOptions(){this.querySelectorAll('input[type="radio"]').forEach((t=>{t.disabled?t.nextElementSibling.classList.toggle("is-active",!1):t.nextElementSibling.classList.toggle("is-active",t.checked)})),this.options=Array.from(this.querySelectorAll('input[type="radio"]:checked, select'),(t=>({name:t.dataset.name||t.name,value:t.value})))}productBarUpdateOptions(){this.productBar&&(Array.from(this.productBar.querySelectorAll("select")).map((t=>{t.value=this.options.find((e=>e.name===t.name)).value})),this.productBar.querySelectorAll("dropdown-input").forEach((t=>{t.update()})))}updateInventoryNotice(t){const e=this.closest(".product").querySelector("[data-inventory-notice]"),a=t.querySelector("[data-inventory-notice]");a&&e&&(e.innerHTML=a.innerHTML)}updatePickupAvailability(){const t=document.querySelector("pickup-availability");if(t&&this.currentVariant){if(t.dataset.variantId=this.currentVariant.id,this.currentVariant&&this.currentVariant.available)return t.setAttribute("available",""),void t.fetchAvailability(t.dataset.variantId);t.removeAttribute("available"),t.innerHTML=""}}updateVariant(){this.currentVariant=this.getVariantData()}getVariantData(){return this.options.length?this.variants.find((t=>!t.options.map(((t,e)=>this.options[e].value===t)).includes(!1))):this.variants[0]}updateMedia(){if(!this.currentVariant||!this.currentVariant.featured_media)return;let t=this.closest(".product").querySelector("product-media");t||(t=this.closest(".main-product").querySelector("swiper-product-gallery")),t.setActiveMedia(this.currentVariant.featured_media.id)}updateSKU(){document.querySelector(".product__sku")&&(document.querySelector(".product__sku span").innerText=this.currentVariant.sku||"")}updateURL(t){if(!this.currentVariant)return;const e=new URLSearchParams(window.location.search);e[e.has("variant")?"set":"append"]("variant",this.currentVariant.id),t?e[e.has("selling_plan")?"set":"append"]("selling_plan",t):e.delete("selling_plan"),window.history.replaceState({},"",`${this.dataset.url}?${e.toString()}`)}updateVariantInput(){[this.querySelector('[name="id"'),this.installmentsForm?.querySelector('[name="id"]')].forEach((t=>{t&&(t.value=this.currentVariant.id,t.dispatchEvent(new Event("change",{bubbles:!0})))}))}setUnavailable(){const t=this.form.submitButton,e=this.querySelector(`#Product-Price-${this.dataset.sectionId}`);t&&(t.textContent=window.variantStrings.unavailable,e&&e.classList.add("visibility-hidden"))}renderProductInfo(){const t=new URLSearchParams(window.location.search);t[t.has("variant")?"set":"append"]("variant",this.currentVariant.id),this.closest(".product").classList.contains("highlighted-product")||t.append("section_id",this.dataset.sectionId),fetch(`${this.dataset.url}?${t.toString()}`).then((t=>t.text())).then((t=>{const e=(new DOMParser).parseFromString(t,"text/html");[`#Product-Price-${this.dataset.sectionId}`,`#Product-Purchase-Options-${this.dataset.sectionId}`,".product__sticky-cart-wrapper"].map((t=>{const a=document.querySelector(t),i=e.querySelector(t);this.updateInventoryNotice(e),a&&i&&(a.classList.remove("visibility-hidden"),a.innerHTML=i.innerHTML)}))}))}updateVariantOptionsLegend(){this.variantOptionInputs.forEach((t=>{const e=t.closest(".js-product-variants").querySelector("legend").querySelector(".product-selector__label-text");if(e&&t.checked){const a=t.nextElementSibling.title;let i=e.nextElementSibling;if(i&&i.classList.contains("active-variant-label"))i.textContent=a;else{const t=document.createElement("span");t.classList.add("active-variant-label"),t.textContent=a,e.insertAdjacentElement("afterend",t)}}}))}scrollToImage(){this.closest(".product").querySelectorAll("[data-product-images]").forEach((t=>{t.getAttribute("data-product-images").includes(this.currentVariant.id)&&t.scrollIntoView({behavior:"smooth"})}))}}customElements.define("product-selector",t)}